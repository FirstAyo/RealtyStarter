(function(){ const doc = document.documentElement; const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches; const saved = localStorage.getItem('theme'); const initial = saved || (prefersDark ? 'dark' : 'light'); doc.setAttribute('data-theme', initial); function setTheme(mode){ doc.setAttribute('data-theme', mode); localStorage.setItem('theme', mode); const btn = document.getElementById('themeToggle'); if(btn){ btn.setAttribute('aria-pressed', mode === 'dark' ? 'true' : 'false'); } } window.toggleTheme = function(){ const current = doc.getAttribute('data-theme') || 'light'; setTheme(current === 'light' ? 'dark' : 'light'); } const nav = document.getElementById('navLinks'); const hamburger = document.getElementById('hamburger'); if(hamburger && nav){ hamburger.addEventListener('click', function(){ const open = nav.classList.toggle('open'); hamburger.setAttribute('aria-expanded', open ? 'true' : 'false'); if(open){ nav.querySelector('a')?.focus(); } }); document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape'){ nav.classList.remove('open'); hamburger.setAttribute('aria-expanded','false'); } }); document.addEventListener('click', (e)=>{ if(!nav.contains(e.target) && !hamburger.contains(e.target)){ nav.classList.remove('open'); hamburger.setAttribute('aria-expanded','false'); } }); } window.$qs = (s, el=document)=> el.querySelector(s); window.$qsa = (s, el=document)=> [...el.querySelectorAll(s)]; window.$params = new URLSearchParams(location.search); window.$formatPrice = (n)=> new Intl.NumberFormat(undefined, {style:'currency', currency:'USD', maximumFractionDigits:0}).format(n); window.$formatDate = (iso)=> new Date(iso).toLocaleDateString(); window.$slug = (s)=> String(s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); })(); function loadJSON(url){ return $.getJSON(url); }